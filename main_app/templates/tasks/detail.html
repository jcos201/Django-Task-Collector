{% extends 'base.html' %}
{% block content %}

<h1>Task Details</h1>

<div class="row">
    <div class="col s6">
        <div class="card">
            <div class="card-content">
                <span class="card-title">{{ task.name }}</span>
                <p>Description: {{ task.description }}</p>
                <p>Due Date: {{ task.due_date }}</p>
            </div>
            <div class="card-action">
                <a href="{% url 'tasks_update' task.id %}">Edit</a>
                <a href="{% url 'tasks_delete' task.id %}">Delete</a>
            </div>
        </div>
    </div>
    <div class="col s6">
        <div class="card">
            <div class="card-content">
                <span class="card-title">Status</span>
                {% if task.status_set.first.status == 'U' %}
                <div class="card-panel yellow lighten-3">{{ task.status_set.first.get_status_display }}</div>
                {% elif task.status_set.first.status == 'N' %}
                <div class="card-panel red darken-2">{{ task.status_set.first.get_status_display }}</div>
                {% else %}
                <div class="card-panel green">{{ task.status_set.first.get_status_display }}</div>
                {% endif %}
            </div>
        </div>
        <form action="{% url 'status_update' task.id %}" method="post">
            {% csrf_token %}
            {{ status_form.as_p }}
            <input type="submit" value="Status Update" class="btn">
        </form>
    </div>
</div>
<hr>
<div class="row">
    <div class="col s6">
        <h4>Team Members For {{ task.name }}</h4>
        {% if task.team_members.count %}
            {% for member in task.team_members.all %}
            <div class="card">
                <div class="card-content">
                    <span class="card-title">
                        {{ member.name }}
                    </span>
                </div>
                <div class="card-action">
                    <form action="{% url 'remove_team_members' task.id member.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn">Remove</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <h7>{{ task.name }} has no team members assigned.</h7>
        {% endif %}
    </div>
    <div class="col s6">
        <h4>Available Team Members</h4>
        {% if available_team_members.count %}
            {% for member in available_team_members %}
                <div class="card">
                    <div class="card-content">
                        <span class="card-title">
                            <h7> {{member.name}} </h7>
                            <blockquote>Role: {{ member.role }}</blockquote>
                        </span>
                    </div>
                    <div class="card-action">
                        <form action="{% url 'assoc_team_members' task.id member.id %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn">Add</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <h5>No available team members for {{task.name}}</h5>
        {% endif %}
    </div>
</div>

<script>
    var selectEl = document.getElementById('id_status');
    M.FormSelect.init(selectEl);
</script>

{% endblock %}